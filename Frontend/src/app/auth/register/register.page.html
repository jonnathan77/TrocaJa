<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/login"></ion-back-button>
    </ion-buttons>
    <ion-title>Cadastrar-se</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="register-content">
  <div class="register-container">
    <!-- Header -->
    <div class="header-section">
      <ion-icon name="person-add" size="large" color="primary"></ion-icon>
      <h1>Criar Conta</h1>
      <p>Preencha os dados abaixo para se cadastrar</p>
    </div>

    <!-- Register Form -->
    <ion-card class="register-card">
      <ion-card-content>
        <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
          <!-- User Type Selection -->
          <div class="user-type-section">
            <h3>Tipo de Conta</h3>
            <ion-segment 
              [(ngModel)]="userType" 
              [ngModelOptions]="{standalone: true}" 
              (ionChange)="onUserTypeChange($event)">
              <ion-segment-button value="user">
                <ion-icon name="person"></ion-icon>
                <ion-label>Usuário</ion-label>
              </ion-segment-button>
              <ion-segment-button value="provider">
                <ion-icon name="business"></ion-icon>
                <ion-label>Prestador</ion-label>
              </ion-segment-button>
            </ion-segment>
          </div>

          <!-- Personal Information -->
          <div class="form-section">
            <h3>Dados Pessoais</h3>
            
            <ion-item>
              <ion-icon name="person" slot="start" color="medium"></ion-icon>
              <ion-label position="stacked">Nome Completo *</ion-label>
              <ion-input 
                type="text" 
                formControlName="fullName"
                placeholder="Seu nome completo"
                [class.ion-invalid]="isFieldInvalid('fullName')">
              </ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="isFieldInvalid('fullName')">
              <small>Nome completo é obrigatório</small>
            </ion-text>

            <ion-item>
              <ion-icon name="mail" slot="start" color="medium"></ion-icon>
              <ion-label position="stacked">E-mail *</ion-label>
              <ion-input 
                type="email" 
                formControlName="email"
                placeholder="seu@email.com"
                [class.ion-invalid]="isFieldInvalid('email')">
              </ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="isFieldInvalid('email')">
              <small>Por favor, insira um e-mail válido</small>
            </ion-text>

            <ion-item>
              <ion-icon name="call" slot="start" color="medium"></ion-icon>
              <ion-label position="stacked">Telefone *</ion-label>
              <ion-input 
                type="tel" 
                formControlName="phone"
                placeholder="(11) 99999-9999"
                [class.ion-invalid]="isFieldInvalid('phone')">
              </ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="isFieldInvalid('phone')">
              <small>Telefone é obrigatório</small>
            </ion-text>
          </div>

          <!-- Service Provider Specific Fields -->
          <div class="form-section" *ngIf="userType === 'provider'">
            <h3>Dados da Oficina</h3>
            
            <ion-item>
              <ion-icon name="business" slot="start" color="medium"></ion-icon>
              <ion-label position="stacked">Nome da Oficina *</ion-label>
              <ion-input 
                type="text" 
                formControlName="businessName"
                placeholder="Nome da sua oficina"
                [class.ion-invalid]="isFieldInvalid('businessName')">
              </ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="isFieldInvalid('businessName')">
              <small>Nome da oficina é obrigatório</small>
            </ion-text>

            <ion-item>
              <ion-icon name="location" slot="start" color="medium"></ion-icon>
              <ion-label position="stacked">Endereço *</ion-label>
              <ion-input 
                type="text" 
                formControlName="address"
                placeholder="Endereço completo da oficina"
                [class.ion-invalid]="isFieldInvalid('address')">
              </ion-input>
            </ion-item>
            <ion-text color="danger" *ngIf="isFieldInvalid('address')">
              <small>Endereço é obrigatório</small>
            </ion-text>

            <ion-item>
              <ion-icon name="card" slot="start" color="medium"></ion-icon>
              <ion-label position="stacked">CNPJ</ion-label>
              <ion-input 
                type="text" 
                formControlName="cnpj"
                placeholder="00.000.000/0000-00">
              </ion-input>
            </ion-item>
          </div>

          <!-- Password Section -->
          <div class="form-section">
            <h3>Senha</h3>
            
            <ion-item>
              <ion-icon name="lock-closed" slot="start" color="medium"></ion-icon>
              <ion-label position="stacked">Senha *</ion-label>
              <ion-input 
                [type]="showPassword ? 'text' : 'password'"
                formControlName="password"
                placeholder="Mínimo 6 caracteres"
                [class.ion-invalid]="isFieldInvalid('password')">
              </ion-input>
              <ion-button 
                fill="clear" 
                slot="end" 
                (click)="togglePasswordVisibility()">
                <ion-icon [name]="showPassword ? 'eye-off' : 'eye'"></ion-icon>
              </ion-button>
            </ion-item>
            <ion-text color="danger" *ngIf="isFieldInvalid('password')">
              <small>A senha deve ter pelo menos 6 caracteres</small>
            </ion-text>

            <ion-item>
              <ion-icon name="lock-closed" slot="start" color="medium"></ion-icon>
              <ion-label position="stacked">Confirmar Senha *</ion-label>
              <ion-input 
                [type]="showConfirmPassword ? 'text' : 'password'"
                formControlName="confirmPassword"
                placeholder="Digite a senha novamente"
                [class.ion-invalid]="isFieldInvalid('confirmPassword')">
              </ion-input>
              <ion-button 
                fill="clear" 
                slot="end" 
                (click)="toggleConfirmPasswordVisibility()">
                <ion-icon [name]="showConfirmPassword ? 'eye-off' : 'eye'"></ion-icon>
              </ion-button>
            </ion-item>
            <ion-text color="danger" *ngIf="isFieldInvalid('confirmPassword')">
              <small>As senhas não coincidem</small>
            </ion-text>
          </div>

          <!-- Terms and Conditions -->
          <ion-item>
            <ion-checkbox 
              [(ngModel)]="acceptTerms" 
              [ngModelOptions]="{standalone: true}" 
              slot="start">
            </ion-checkbox>
            <ion-label>
              <p>Eu aceito os <a href="#" (click)="showTerms($event)">Termos de Uso</a> e <a href="#" (click)="showPrivacy($event)">Política de Privacidade</a></p>
            </ion-label>
          </ion-item>

          <!-- Register Button -->
          <ion-button 
            expand="block" 
            type="submit" 
            [disabled]="registerForm.invalid || !acceptTerms || isLoading"
            class="register-button">
            <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
            <span *ngIf="!isLoading">Criar Conta</span>
          </ion-button>
        </form>
      </ion-card-content>
    </ion-card>

    <!-- Login Link -->
    <div class="login-link-section">
      <p>Já tem uma conta?</p>
      <ion-button 
        fill="clear" 
        (click)="goToLogin()"
        class="login-link-button">
        Fazer Login
      </ion-button>
    </div>
  </div>
</ion-content>
